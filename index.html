<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>TROPA DO GORDÃO | PAINEL ELITE</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;900&family=Open+Sans:wght@700;800&display=swap" rel="stylesheet">
    <style>
        :root { --primary: #ff0000; --bg: #000; --card: #0a0a0a; --border: #440000; --gold: #ffd700; --discord: #5865F2; }
        * { box-sizing: border-box; font-family: 'Orbitron', sans-serif; -webkit-tap-highlight-color: transparent; }
        body { background: var(--bg); color: white; margin: 0; overflow-x: hidden; }

        #loading { position: fixed; inset: 0; background: #000; z-index: 10000; display: flex; flex-direction: column; align-items: center; justify-content: center; text-align: center; }
        .loading-title { color: red; line-height: 0.9; margin-bottom: 20px; font-size: 2.5rem; font-weight: 900; }
        .loader-bar { width: 220px; height: 8px; background: #111; border-radius: 10px; overflow: hidden; border: 1px solid #400; }
        .loader-fill { width: 0%; height: 100%; background: red; animation: load 3s forwards; }
        @keyframes load { to { width: 100%; } }

        .tag { font-size: 0.65rem; padding: 3px 7px; border-radius: 4px; font-weight: 900; text-transform: uppercase; margin-left: 5px; border: 1px solid transparent; }
        .tag-owner { background: #000; color: #fff; border-color: #fff; }
        .tag-membro { background: #555; color: #fff; }
        
        .header { display: flex; justify-content: space-between; align-items: center; padding: 15px; border-bottom: 2px solid var(--primary); background: #000; position: sticky; top: 0; z-index: 1000; }
        .page { display: none; min-height: 100vh; padding-bottom: 100px; }
        .active { display: block; }
        .card { background: var(--card); border: 1px solid var(--border); border-radius: 12px; padding: 15px; margin: 12px; position: relative; }
        .btn { border: none; padding: 12px; border-radius: 6px; font-weight: 900; cursor: pointer; text-transform: uppercase; color: white; width: 100%; display: block; margin: 5px 0; text-align: center; font-size: 11px; }
        .btn-red { background: linear-gradient(45deg, #800, #f00); }
        .btn-green { background: #00ff44; color: black; }
        
        .user-pic-min { width: 40px; height: 40px; border-radius: 50%; border: 1px solid var(--primary); object-fit: cover; }
        input, textarea, select { width: 100%; background: #111; border: 1px solid #333; color: white; padding: 10px; margin: 5px 0; border-radius: 5px; }

        #form-modal { display: none; position: fixed; inset: 0; background: rgba(0,0,0,0.9); z-index: 2000; padding: 20px; overflow-y: auto; }
        .modal-content { background: #0a0a0a; border: 1px solid red; padding: 20px; border-radius: 15px; }
        .del-btn { position: absolute; top: 10px; right: 10px; color: #444; cursor: pointer; }
    </style>
</head>
<body>

    <div id="loading">
        <h1 class="loading-title">TROPA<br>DO<br>GORDÃO</h1>
        <div class="loader-bar"><div class="loader-fill"></div></div>
    </div>

    <div id="form-modal">
        <div class="modal-content">
            <h2 style="color:red; text-align:center">RESPOSTAS</h2>
            <div id="modal-body" style="font-size: 12px;"></div>
            <button class="btn btn-red" onclick="fecharModal()">FECHAR</button>
        </div>
    </div>

    <div class="header" id="navbar" style="display:none;">
        <div style="display:flex; gap:15px; align-items:center;">
            <i class="fas fa-bullhorn" style="color:var(--gold); font-size:1.4rem" onclick="showPage('page-noticias')"></i>
            <a href="https://discord.gg/4NqJpjKyc" target="_blank" style="color:var(--discord); font-size:1.6rem; text-decoration:none;"><i class="fab fa-discord"></i></a>
        </div>
        <div style="color:red; font-weight:900;">TDG ELITE</div>
        <div style="display:flex; align-items:center; gap:12px;">
            <i class="fas fa-trophy" style="color:var(--gold)" onclick="showPage('page-ranking')"></i>
            <i class="fas fa-user-shield" id="admin-shield" style="display:none; color:cyan;" onclick="showPage('page-admin-panel')"></i>
            <img src="" id="nav-avatar" class="user-pic-min" onclick="verPerfil(window.user.nick)">
        </div>
    </div>

    <div id="page-login" class="page active">
        <div class="card" style="margin-top: 50px; text-align: center;">
            <h2 style="color:red">LOGIN TDG</h2>
            <input type="text" id="u-nick" placeholder="NICK">
            <input type="password" id="u-pass" placeholder="SENHA">
            <button class="btn btn-red" onclick="auth()">ENTRAR / REGISTRAR</button>
        </div>
    </div>

    <div id="page-main" class="page">
        <div style="padding:15px; display:flex; gap:10px;">
            <button class="btn btn-red" onclick="showPage('page-forum')">FÓRUM</button>
            <button class="btn btn-green" onclick="showPage('page-form')">ENVIAR FORMULÁRIO</button>
        </div>
        <div id="feed-forms"></div>
    </div>

    <div id="page-form" class="page">
        <div class="card">
            <h2 style="color:red; text-align:center">RECRUTAMENTO</h2>
            <div id="q-list">
                <p>1. Nome Real:</p><input type="text" class="qa">
                <p>2. Idade:</p><input type="number" class="qa">
                <p>3. Nick In-Game:</p><input type="text" class="qa">
                <p>4. Nick Discord:</p><input type="text" class="qa">
                <p>5. WhatsApp:</p><input type="text" class="qa">
                <p>6. Horários:</p><textarea class="qa"></textarea>
                <p>7-11. Regras RP (PG, CL, RDM, VDM, MG):</p><textarea class="qa" placeholder="Explique cada uma..."></textarea>
                <p>12-17. Experiência e Motivação:</p><textarea class="qa" placeholder="Por que a TDG? Qual sua habilidade?"></textarea>
                <button class="btn btn-green" onclick="enviarForm()">ENVIAR FORMULÁRIO</button>
            </div>
        </div>
    </div>

    <div id="page-ranking" class="page"><div class="card"><h2 style="color:var(--gold); text-align:center">TOP 10</h2><div id="ranking-list"></div><button class="btn btn-red" onclick="showPage('page-main')">VOLTAR</button></div></div>
    
    <div id="page-forum" class="page">
        <div id="forum-list"></div>
        <div style="position:fixed; bottom:0; width:100%; background:#000; padding:15px; border-top:2px solid red;">
            <input type="text" id="f-msg" placeholder="Falar no fórum...">
            <button class="btn btn-red" onclick="postarForum()">POSTAR</button>
        </div>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getDatabase, ref, set, push, onValue, update, remove, query, limitToLast } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js";

        const firebaseConfig = {
            apiKey: "AIzaSyCiSlpHSVj3NPOq4NO7MhS_xPiqCipmMAo",
            authDomain: "tropa-do-qg.firebaseapp.com",
            projectId: "tropa-do-qg",
            databaseURL: "https://tropa-do-qg-default-rtdb.firebaseio.com",
            storageBucket: "tropa-do-qg.firebasestorage.app",
            appId: "1:1050965334818:web:55ceb510e476b4b686237b"
        };

        const app = initializeApp(firebaseConfig);
        const db = getDatabase(app);
        window.user = JSON.parse(localStorage.getItem('tg_user')) || null;

        window.onload = () => {
            setTimeout(() => {
                document.getElementById('loading').style.display = 'none';
                if(window.user) {
                    onValue(ref(db, 'users/' + window.user.nick), (s) => {
                        const d = s.val();
                        if(!d) return;
                        window.user = d;
                        localStorage.setItem('tg_user', JSON.stringify(d));
                        document.getElementById('navbar').style.display = 'flex';
                        if(d.tag === 'owner') document.getElementById('admin-shield').style.display = 'block';
                        showPage(d.hasForm ? 'page-main' : 'page-form');
                        mainLoop();
                    });
                }
            }, 3000);
        };

        window.auth = () => {
            const n = document.getElementById('u-nick').value.trim();
            const p = document.getElementById('u-pass').value.trim();
            if(!n || !p) return alert("Preencha tudo!");
            
            onValue(ref(db, 'users/'+n), s => {
                const d = s.val();
                if(d) {
                    if(d.pass === p) {
                        localStorage.setItem('tg_user', JSON.stringify(d));
                        location.reload();
                    } else alert("Senha incorreta");
                } else {
                    const nu = { nick:n, pass:p, tag:'visitante', pic:'', xp:0, hasForm:false };
                    set(ref(db, 'users/'+n), nu).then(() => {
                        localStorage.setItem('tg_user', JSON.stringify(nu));
                        location.reload();
                    });
                }
            }, {onlyOnce:true});
        };

        window.showPage = (id) => {
            document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
            document.getElementById(id).classList.add('active');
        };

        function mainLoop() {
            document.getElementById('nav-avatar').src = window.user.pic || 'https://i.imgur.com/6VBx3io.png';
            
            // Feed de formulários com Like e Comentário
            onValue(ref(db, 'forms'), s => {
                const feed = document.getElementById('feed-forms'); feed.innerHTML = "";
                s.forEach(k => {
                    const f = k.val();
                    const likes = f.likes ? Object.keys(f.likes).length : 0;
                    feed.innerHTML = `<div class="card">
                        <b>${f.u}</b> enviou recrutamento.
                        <button class="btn btn-red" onclick="verRespostas('${k.key}')">ABRIR RESPOSTAS</button>
                        <div style="margin-top:10px; font-size:12px; display:flex; gap:15px">
                            <span onclick="curtir('${k.key}')"><i class="fas fa-heart"></i> ${likes}</span>
                        </div>
                    </div>` + feed.innerHTML;
                });
            });
        }

        window.postarForum = () => {
            const m = document.getElementById('f-msg').value;
            if(m) push(ref(db, 'forum'), { u:window.user.nick, m, ts:Date.now() });
            document.getElementById('f-msg').value = "";
        };

        window.enviarForm = () => {
            const res = Array.from(document.querySelectorAll('.qa')).map(i => i.value);
            if(res.some(r => r === "")) return alert("Responda tudo!");
            push(ref(db, 'forms'), { u:window.user.nick, res, ts:Date.now() })
            .then(() => {
                update(ref(db, 'users/'+window.user.nick), { hasForm:true, tag:'membro' });
                location.reload();
            });
        };
        
        window.curtir = (id) => update(ref(db, `forms/${id}/likes/${window.user.nick}`), { v:true });
    </script>
</body>
</html>
