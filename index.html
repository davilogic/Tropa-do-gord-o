<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>TROPA DO GORDÃO | PAINEL ELITE</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;900&family=Open+Sans:wght@700;800&display=swap" rel="stylesheet">
    <style>
    :root {
        --primary: #ff0000;
        --bg: #000;
        --card: #0a0a0a;
        --border: #440000;
        --gold: #ffd700;
        --discord: #5865F2;
    }

    * {
        box-sizing: border-box;
        font-family: 'Orbitron', sans-serif;
        -webkit-tap-highlight-color: transparent;
    }

    body {
        background: var(--bg);
        color: white;
        margin: 0;
        overflow-x: hidden;
    }
    
    #loading {
        position: fixed;
        inset: 0;
        background: #000;
        z-index: 10000;
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        text-align: center;
    }

    .loading-title {
        color: red;
        line-height: 0.9;
        margin-bottom: 20px;
        font-size: 2.5rem;
        font-weight: 900;
    }

    .loader-bar {
        width: 220px;
        height: 8px;
        background: #111;
        border-radius: 10px;
        overflow: hidden;
        border: 1px solid #400;
    }

    .loader-fill {
        width: 0%;
        height: 100%;
        background: red;
        animation: load 5s forwards;
    }

    @keyframes load {
        to { width: 100%; }
    }

    .tag { font-size: 0.65rem; padding: 3px 7px; border-radius: 4px; font-weight: 900; text-transform: uppercase; }
    .tag-owner { background:#000; color:#fff; border:1px solid #fff; }
    .tag-gerente { background:#ff0000; }
    .tag-admin { background:#00ccff; color:#000; }
    .tag-moderador { background:#00ff00; color:#000; }
    .tag-recrutador { background:#ffff00; color:#000; }
    .tag-membro { background:#555; }
    .tag-visitante { background:#222; color:#888; border:1px solid #444; }

    .header { display:flex; justify-content:space-between; align-items:center; padding:15px; border-bottom:2px solid var(--primary); background:#000; position:sticky; top:0; z-index:1000; }
    .page { display:none; min-height:100vh; padding-bottom:100px; }
    .active { display:block; }
    .card { background:var(--card); border:1px solid var(--border); border-radius:12px; padding:15px; margin:12px; position:relative; }
    .btn { border:none; padding:12px; border-radius:6px; font-weight:900; cursor:pointer; text-transform:uppercase; width:100%; font-size:11px; }
    .btn-red { background:linear-gradient(45deg,#800,#f00); color:white; }
    .btn-green { background:#00ff44; color:black; }
    .btn-discord { background:var(--discord); color:white; }

    .user-pic-min { width:40px; height:40px; border-radius:50%; border:1px solid var(--primary); object-fit:cover; }

    input, textarea, select {
        width:100%;
        background:#111;
        border:1px solid #333;
        color:white;
        padding:10px;
        margin:5px 0;
        border-radius:5px;
    }

    #form-modal {
        display:none;
        position:fixed;
        inset:0;
        background:rgba(0,0,0,0.9);
        z-index:2000;
        padding:20px;
        overflow-y:auto;
    }

    .modal-content {
        background:#0a0a0a;
        border:1px solid red;
        padding:20px;
        border-radius:15px;
    }

    .del-btn {
        position:absolute;
        top:10px;
        right:10px;
        color:#444;
        cursor:pointer;
    }
</style>
</head>
<body>

    <div id="loading">
        <h1 class="loading-title">TROPA<br>DO<br>GORDÃO</h1>
        <div class="loader-bar"><div class="loader-fill"></div></div>
    </div>

    <div id="form-modal">
        <div class="modal-content">
            <h2 style="color:red; text-align:center">RESPOSTAS</h2>
            <div id="modal-body" style="font-size: 12px;"></div>
            <button class="btn btn-red" onclick="fecharModal()">FECHAR</button>
        </div>
    </div>

    <div class="header" id="navbar" style="display:none;">
        <div style="display:flex; gap:15px; align-items:center;">
            <i class="fas fa-bullhorn" style="color:var(--gold); font-size:1.4rem" onclick="showPage('page-noticias')"></i>
            <a href="https://discord.gg/4NqJpjKyc" target="_blank" style="color:var(--discord); font-size:1.6rem; text-decoration:none;"><i class="fab fa-discord"></i></a>
        </div>
        <div style="color:red; font-weight:900;">TDG ELITE</div>
        <div style="display:flex; align-items:center; gap:12px;">
            <i class="fas fa-trophy" style="color:var(--gold)" onclick="showPage('page-ranking')"></i>
            <i class="fas fa-user-shield" id="admin-shield" style="display:none; color:cyan;" onclick="showPage('page-admin-panel')"></i>
            <i class="fas fa-key" style="opacity:0" onclick="ativarPainelAdmin()"></i>
            <img src="" id="nav-avatar" class="user-pic-min" onclick="verPerfil(window.user.nick)">
        </div>
    </div>

    <div id="page-login" class="page active">
        <div class="card" style="margin-top: 50px; text-align: center;">
            <h2 style="color:red">LOGIN TDG</h2>
            <input type="text" id="u-nick" placeholder="NICK">
            <input type="password" id="u-pass" placeholder="SENHA">
            <button class="btn btn-red" onclick="auth()">ENTRAR / REGISTRAR</button>
        </div>
    </div>

    <div id="page-main" class="page">
        <div style="padding:15px; display:flex; gap:10px;">
            <button class="btn btn-red" onclick="showPage('page-forum')">FÓRUM</button>
            <button class="btn btn-green" onclick="showPage('page-form')">ENVIAR FORMULÁRIO</button>
        </div>
        <div id="feed-forms"></div>
    </div>

    <div id="page-form" class="page">
        <div class="card">
            <h2 style="color:red; text-align:center">RECRUTAMENTO</h2>
            <div id="q-list">
                <p>1. Nome Real:</p><input type="text" class="qa">
                <p>2. Idade:</p><input type="number" class="qa">
                <p>3. Nick In-Game:</p><input type="text" class="qa">
                <p>4. Nick Discord:</p><input type="text" class="qa">
                <p>5. WhatsApp:</p><input type="text" class="qa">
                <p>6. Horários:</p><textarea class="qa"></textarea>
                <p>7. O que é PG?</p><textarea class="qa"></textarea>
                <p>8. O que é CL?</p><textarea class="qa"></textarea>
                <p>9. O que é RDM?</p><textarea class="qa"></textarea>
                <p>10. O que é VDM?</p><textarea class="qa"></textarea>
                <p>11. O que é MG?</p><textarea class="qa"></textarea>
                <p>12. Já foi de alguma Fac no RP? Qual?</p><textarea class="qa"></textarea>
                <p>13. Sabe das regras do servidor Galaxy?</p><textarea class="qa"></textarea>
                <p>14. Por que quer entrar na fac?</p><textarea class="qa"></textarea>
                <p>15. O que é a TDG para você?</p><textarea class="qa"></textarea>
                <p>16. É bom no que?</p><textarea class="qa"></textarea>
                <p>17. Fale 5 qualidades e 5 defeitos seus:</p><textarea class="qa"></textarea>
                <button class="btn btn-green" onclick="enviarForm()">ENVIAR FORMULÁRIO</button>
                <div id="btn-voltar-form"></div>
            </div>
        </div>
    </div>

    <div id="page-admin-panel" class="page">
        <div class="card">
            <h2 style="color:cyan">STAFF HUB</h2>
            <div id="staff-chat-box" style="height:120px; overflow-y:auto; background:#050505; padding:10px; font-size:11px; border:1px solid #333"></div>
            <input type="text" id="staff-msg" placeholder="Chat interno...">
            <button class="btn btn-green" onclick="postarStaffChat()">ENVIAR</button>
            <hr style="border:1px solid #333; margin:15px 0">
            <input type="text" id="target-nick" placeholder="Nick do alvo">
            <input type="number" id="xp-amount" placeholder="XP">
            <div style="display:flex; gap:5px">
                <button class="btn btn-green" onclick="darRespeito(true)">DAR XP</button>
                <button class="btn btn-red" onclick="darRespeito(false)">REMOVER XP</button>
            </div>
            <select id="punish-type">
                <option value="banido">BANIR (BAN)</option>
                <option value="mutado">CASTIGO (MUTE)</option>
                <option value="ativo">REMOVER PUNIÇÃO</option>
            </select>
            <button class="btn btn-red" onclick="aplicarPunicao()">APLICAR STATUS</button>
            <button class="btn" style="background:#222" onclick="showPage('page-main')">VOLTAR</button>
        </div>
    </div>

    <div id="page-ranking" class="page">
        <div class="card">
            <h2 style="color:var(--gold); text-align:center">TOP 10 ELITE</h2>
            <div id="ranking-list"></div>
            <button class="btn btn-red" onclick="showPage('page-main')">VOLTAR</button>
        </div>
    </div>

    <div id="page-forum" class="page">
        <button class="btn" style="background:#111; margin:10px; width:auto" onclick="showPage('page-main')">VOLTAR</button>
        <div id="forum-list" style="padding-bottom:150px"></div>
        <div style="position:fixed; bottom:0; width:100%; background:#000; padding:15px; border-top:2px solid red;">
            <input type="text" id="f-msg" placeholder="Falar no fórum...">
            <input type="file" id="f-img" accept="image/*">
            <button class="btn btn-red" onclick="postarForum()">POSTAR</button>
        </div>
    </div>

    <div id="page-noticias" class="page">
        <div class="card">
            <h3 style="color:var(--gold)">AVISOS STAFF</h3>
            <div id="staff-news-input" style="display:none">
                <textarea id="n-txt" placeholder="Mensagem..."></textarea>
                <input type="file" id="n-img" accept="image/*">
                <input type="text" id="n-vid" placeholder="Link vídeo">
                <button class="btn btn-green" onclick="postarAviso()">PUBLICAR</button>
            </div>
            <div id="news-feed"></div>
            <button class="btn" style="background:#222" onclick="showPage('page-main')">VOLTAR</button>
        </div>
    </div>

    <div id="page-profile" class="page">
        <div class="card" style="text-align:center">
            <img src="" id="prof-pic" style="width:100px; height:100px; border-radius:50%; border:2px solid red; object-fit:cover">
            <h2 id="prof-nick"></h2>
            <div id="prof-tag-box"></div>
            <p id="prof-xp" style="color:gold"></p>
            <div id="self-edit" style="display:none">
                <input type="file" id="new-pic-file">
                <textarea id="new-bio" placeholder="Bio..."></textarea>
                <button class="btn btn-green" onclick="saveProfile()">SALVAR</button>
                <button class="btn" style="background:#333" onclick="localStorage.clear(); location.reload();">LOGOUT</button>
            </div>
            <button class="btn btn-red" onclick="showPage('page-main')">VOLTAR</button>
        </div>
    </div>

        const app = initializeApp(firebaseConfig);
        const db = getDatabase(app);
        window.user = JSON.parse(localStorage.getItem('tg_user')) || null;
        const PERGUNTAS = ["Nome", "Idade", "Nick In-Game", "Discord", "WhatsApp", "Horários", "PG", "CL", "RDM", "VDM", "MG", "Experiência Fac", "Regras Galaxy", "Motivo Entrada", "O que é TDG", "Habilidade", "Qualid/Defeitos"];

        window.onload = () => {
            setTimeout(() => {
                document.getElementById('loading').style.display = 'none';
                if(window.user) {
                    onValue(ref(db, 'users/' + window.user.nick), (s) => {
                        const d = s.val();
                        if(!d) return;
                        if(d.status === 'banido') { alert("VOCÊ FOI BANIDO!"); localStorage.clear(); location.reload(); return; }
                        window.user = d;
                        localStorage.setItem('tg_user', JSON.stringify(d));
                        document.getElementById('navbar').style.display = 'flex';
                        
                        if(!['visitante', 'membro'].includes(d.tag)) document.getElementById('admin-shield').style.display = 'block';
                        
                        // Trava de formulário
                        if(!d.hasForm) {
                            showPage('page-form');
                            document.getElementById('btn-voltar-form').innerHTML = "";
                        } else {
                            showPage('page-main');
                            document.getElementById('btn-voltar-form').innerHTML = `<button class="btn" style="background:#222" onclick="showPage('page-main')">VOLTAR</button>`;
                        }
                        mainLoop();
                    });
                }
            }, 4000);
        };

        window.showPage = (id) => {
            document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
            document.getElementById(id).classList.add('active');
            window.scrollTo(0,0);
        };

        window.auth = () => {
            const n = document.getElementById('u-nick').value.trim();
            const p = document.getElementById('u-pass').value.trim();
            if(!n || !p) return;
            onValue(ref(db, 'users/'+n), s => {
                const d = s.val();
                if(d && d.pass === p) { localStorage.setItem('tg_user', JSON.stringify(d)); location.reload(); }
                else if(!d) {
                    const nu = { nick:n, pass:p, tag:'visitante', pic:'', bio:'', status:'ativo', xp:0, hasForm:false };
                    set(ref(db, 'users/'+n), nu).then(() => { localStorage.setItem('tg_user', JSON.stringify(nu)); location.reload(); });
                } else alert("Senha incorreta");
            }, {onlyOnce:true});
        };

        window.enviarForm = () => {
            const res = Array.from(document.querySelectorAll('.qa')).map(i => i.value);
            if(res.some(r => r === "")) return alert("Responda as 17 perguntas!");
            push(ref(db, 'forms'), { u:window.user.nick, pic:window.user.pic||'', tag:'membro', res, ts:Date.now() })
            .then(() => { update(ref(db, 'users/'+window.user.nick), { hasForm:true, tag:'membro' }); location.reload(); });
        };

        window.darRespeito = (adicionar) => {
            const n = document.getElementById('target-nick').value;
            let x = parseInt(document.getElementById('xp-amount').value) || 0;
            if(!adicionar) x = -x;
            runTransaction(ref(db, `users/${n}/xp`), c => (c||0)+x).then(()=>alert("XP Atualizado!"));
        };

        window.aplicarPunicao = () => {
            const n = document.getElementById('target-nick').value;
            const s = document.getElementById('punish-type').value;
            update(ref(db, 'users/'+n), { status:s }).then(()=>alert("Status Aplicado!"));
        };

        window.ativarPainelAdmin = () => {
            if(prompt("CODIGO OWNER:") === "2012") {
                update(ref(db, 'users/'+window.user.nick), { tag:'owner' }).then(()=>location.reload());
            }
        };

        function mainLoop() {
            document.getElementById('nav-avatar').src = window.user.pic || 'https://i.imgur.com/6VBx3io.png';
            const isStaff = !['visitante', 'membro'].includes(window.user.tag);
            if(isStaff) document.getElementById('staff-news-input').style.display = 'block';

            // RANKING TOP 10 (FIXED)
            onValue(ref(db, 'users'), s => {
                const l = document.getElementById('ranking-list'); l.innerHTML = "";
                let arr = []; s.forEach(u => { let val = u.val(); if(val.status !== 'banido') arr.push(val); });
                arr.sort((a,b)=>(b.xp||0)-(a.xp||0)).slice(0,10).forEach((u,i)=>{
                    l.innerHTML += `<div style="display:flex; align-items:center; gap:10px; padding:10px; border-bottom:1px solid #222">
                        <b style="color:red">${i+1}º</b> <img src="${u.pic||'https://i.imgur.com/6VBx3io.png'}" class="user-pic-min" style="width:30px; height:30px">
                        <span style="font-size:12px">${u.nick}</span> <span class="tag tag-${u.tag}">[${u.tag}]</span>
                        <span style="margin-left:auto; color:gold; font-size:11px">${u.xp||0} XP</span>
                    </div>`;
                });
            });

            // FEED FORMS
            onValue(ref(db, 'forms'), s => {
                const feed = document.getElementById('feed-forms'); feed.innerHTML = "";
                s.forEach(k => {
                    const f = k.val();
                    const likes = f.likes ? Object.keys(f.likes).length : 0;
                   feed.innerHTML += `<div class="card"> ... </div>`;
                        ${isStaff ? `<i class="fas fa-trash del-btn" onclick="apagar('forms/${k.key}')"></i>` : ''}
                        <div style="display:flex; align-items:center; gap:10px; margin-bottom:10px">
                            <img src="${f.pic || 'https://i.imgur.com/6VBx3io.png'}" class="user-pic-min">
                            <div><b>${f.u}</b> <span class="tag tag-membro">[MEMBRO]</span></div>
                        </div>
                        <button class="btn btn-red" onclick="lerMais('${k.key}')">VER RESPOSTAS (17)</button>
                        <div style="margin-top:10px; display:flex; gap:20px; font-size:13px">
                            <span onclick="curtirForm('${k.key}')"><i class="fas fa-heart" style="color:red"></i> ${likes}</span>
                            <span onclick="comentarForm('${k.key}')"><i class="fas fa-comment"></i> Comentar</span>
                        </div>
                        <div id="comms-${k.key}" style="margin-top:10px; font-size:11px; border-top:1px solid #222; padding-top:5px"></div>
                    </div>` + feed.innerHTML;
                    if(f.comms) Object.keys(f.comms).forEach(c => {
                        const cm = f.comms[c];
                        document.getElementById(`comms-${k.key}`).innerHTML += `<div><b style="color:red">${cm.u}:</b> ${cm.t}</div>`;
                    });
                });
            });

            // STAFF CHAT
            if(isStaff) {
                onValue(ref(db, 'staff_chat'), s => {
                    const b = document.getElementById('staff-chat-box'); b.innerHTML = "";
                    s.forEach(k => { const d = k.val(); b.innerHTML += `<div><b>${d.u}:</b> ${d.m}</div>`; });
                    b.scrollTop = b.scrollHeight;
                });
            }

            // FORUM & NOTICES (MANTIDOS)
            onValue(ref(db, 'forum'), s => {
                const l = document.getElementById('forum-list'); l.innerHTML = "";
                s.forEach(k => { const m = k.val(); l.innerHTML = `<div class="card">${isStaff ? `<i class="fas fa-trash del-btn" onclick="apagar('forum/${k.key}')"></i>` : ''}<b class="tag tag-${m.tag}">[${m.tag}]</b> <b>${m.u}</b><p>${m.m}</p>${m.img ? `<img src="${m.img}" style="width:100%; border-radius:8px">` : ''}</div>` + l.innerHTML; });
            });
            onValue(ref(db, 'notices'), s => {
                const f = document.getElementById('news-feed'); f.innerHTML = "";
                s.forEach(k => { const n = k.val(); let media = n.img ? `<img src="${n.img}" style="width:100%; margin-top:10px; border-radius:8px">` : ''; if(n.vid) media += `<iframe style="width:100%; height:200px; margin-top:10px" src="${n.vid.replace('watch?v=', 'embed/')}" frameborder="0"></iframe>`; f.innerHTML = `<div class="card" style="border-left:4px solid gold">${isStaff ? `<i class="fas fa-trash del-btn" onclick="apagar('notices/${k.key}')"></i>` : ''}<b style="color:gold">[STAFF] ${n.u}</b><p>${n.m}</p>${media}</div>` + f.innerHTML; });
            });
        }

        window.lerMais = (id) => {
            onValue(ref(db, `forms/${id}`), s => {
                const f = s.val(); let h = ""; f.res.forEach((r,i) => h += `<p style='margin:5px 0'><b>${i+1}. ${PERGUNTAS[i]}:</b><br><span style='color:white'>${r}</span></p><hr style='border:0.1px solid #222'>`);
                document.getElementById('modal-body').innerHTML = h; document.getElementById('form-modal').style.display = 'block';
            }, {onlyOnce:true});
        };
        window.fecharModal = () => document.getElementById('form-modal').style.display = 'none';
        window.curtirForm = (id) => update(ref(db, `forms/${id}/likes/${window.user.nick}`), { liked:true });
        window.comentarForm = (id) => { const t = prompt("Comentário:"); if(t) push(ref(db, `forms/${id}/comms`), { u:window.user.nick, t }); };
        window.apagar = (path) => { if(confirm("Apagar?")) remove(ref(db, path)); };
        window.postarStaffChat = () => { const m = document.getElementById('staff-msg').value; if(m) push(ref(db, 'staff_chat'), { u:window.user.nick, m }); document.getElementById('staff-msg').value = ""; };
        window.postarForum = () => { const m = document.getElementById('f-msg').value; const file = document.getElementById('f-img').files[0]; if(file) { const r = new FileReader(); r.onload = (e) => push(ref(db, 'forum'), { u:window.user.nick, tag:window.user.tag, m, img:e.target.result }); r.readAsDataURL(file); } else if(m) push(ref(db, 'forum'), { u:window.user.nick, tag:window.user.tag, m }); };
        window.postarAviso = () => { const m = document.getElementById('n-txt').value; const vid = document.getElementById('n-vid').value; const file = document.getElementById('n-img').files[0]; const send = (img) => push(ref(db, 'notices'), { u:window.user.nick, m, vid, img }); if(file) { const r = new FileReader(); r.onload = (e) => send(e.target.result); r.readAsDataURL(file); } else send(null); };
        window.verPerfil = (nick) => { onValue(ref(db, 'users/'+nick), s => { const d = s.val(); document.getElementById('prof-pic').src = d.pic||'https://i.imgur.com/6VBx3io.png'; document.getElementById('prof-nick').innerText = d.nick; document.getElementById('prof-tag-box').innerHTML = `<span class="tag tag-${d.tag}">[${d.tag}]</span>`; document.getElementById('prof-xp').innerText = (d.xp||0) + " XP"; document.getElementById('self-edit').style.display = (nick === window.user.nick)?'block':'none'; showPage('page-profile'); }, {onlyOnce:true}); };
        window.saveProfile = () => { const bio = document.getElementById('new-bio').value; const file = document.getElementById('new-pic-file').files[0]; if(file) { const r = new FileReader(); r.onload = (e) => update(ref(db, 'users/'+window.user.nick), { bio, pic:e.target.result }).then(()=>location.reload()); r.readAsDataURL(file); } else update(ref(db, 'users/'+window.user.nick), { bio }).then(()=>location.reload()); };
    </script>
  
</body>
<script type="module">
  // Import the functions you need from the SDKs you need
  import { initializeApp } from "https://www.gstatic.com/firebasejs/12.7.0/firebase-app.js";
  // TODO: Add SDKs for Firebase products that you want to use
  // https://firebase.google.com/docs/web/setup#available-libraries

  // Your web app's Firebase configuration
  const firebaseConfig = {
    apiKey: "AIzaSyCiSlpHSVj3NPOq4NO7MhS_xPiqCipmMAo",
    authDomain: "tropa-do-qg.firebaseapp.com",
    projectId: "tropa-do-qg",
    storageBucket: "tropa-do-qg.firebasestorage.app",
    messagingSenderId: "1050965334818",
    appId: "1:1050965334818:web:55ceb510e476b4b686237b"
  };

  // Initialize Firebase
  const app = initializeApp(firebaseConfig);
</script>
</html>
